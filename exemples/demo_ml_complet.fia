# demo_ml_complet.fia - DÃ©monstration complÃ¨te ML avec dataset rÃ©aliste
importer "lib/ml.fia" comme ml
importer "lib/utils.fia" comme utils

imprimer("ğŸš€ === DÃ‰MONSTRATION ML COMPLÃˆTE F-IA PHASE 3 ===")
imprimer("ğŸ“… DÃ©marrÃ© le:", utils.date_actuelle(), "Ã ", utils.heure_actuelle())
imprimer()

# === PARTIE 1: CLASSIFICATION MULTI-CLASSE ===
imprimer("ğŸ¯ === CLASSIFICATION: PRÃ‰DICTION DE PRIX IMMOBILIER ===")

# DonnÃ©es rÃ©alistes: [surface_m2, nb_chambres, age_annees, distance_centre_km]
soit donnees_immobilier = [
    [45, 2, 5, 2.1],    # Classe 0: Prix bas
    [50, 2, 8, 3.2],    # Classe 0: Prix bas  
    [55, 2, 12, 4.1],   # Classe 0: Prix bas
    [48, 2, 6, 2.8],    # Classe 0: Prix bas
    [75, 3, 3, 1.5],    # Classe 1: Prix moyen
    [80, 3, 7, 2.0],    # Classe 1: Prix moyen
    [85, 3, 5, 1.8],    # Classe 1: Prix moyen
    [78, 3, 9, 2.3],    # Classe 1: Prix moyen
    [120, 4, 2, 0.8],   # Classe 2: Prix Ã©levÃ©
    [130, 4, 4, 1.2],   # Classe 2: Prix Ã©levÃ©
    [125, 4, 3, 1.0],   # Classe 2: Prix Ã©levÃ©
    [135, 5, 1, 0.5]    # Classe 2: Prix Ã©levÃ©
]

soit categories_prix = [0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2]
# 0 = Prix bas, 1 = Prix moyen, 2 = Prix Ã©levÃ©

imprimer("ğŸ“Š Dataset immobilier:", longueur(donnees_immobilier), "propriÃ©tÃ©s")
imprimer("ğŸ·ï¸  CatÃ©gories: 0=Bas, 1=Moyen, 2=Ã‰levÃ©")
imprimer()

# Preprocessing
imprimer("âš™ï¸  === PREPROCESSING ===")
soit donnees_std = ml.standardiser_donnees(donnees_immobilier)
imprimer("âœ… DonnÃ©es standardisÃ©es")

# CrÃ©er et comparer plusieurs modÃ¨les
imprimer("ğŸ¤– === CRÃ‰ATION ET COMPARAISON DE MODÃˆLES ===")

soit rf_immobilier = ml.RandomForestClassifier(100, 5)
soit svm_immobilier = ml.SVM("rbf", 1.0)
soit knn_immobilier = ml.KNNClassifier(3)

imprimer("âœ… 3 modÃ¨les crÃ©Ã©s: Random Forest, SVM, KNN")

# EntraÃ®nement
imprimer("ğŸ¯ === ENTRAÃNEMENT ===")
ml.entrainer(rf_immobilier, donnees_std, categories_prix)
ml.entrainer(svm_immobilier, donnees_std, categories_prix)
ml.entrainer(knn_immobilier, donnees_std, categories_prix)
imprimer("âœ… Tous les modÃ¨les entraÃ®nÃ©s")

# Ã‰valuation comparative
imprimer("ğŸ“ˆ === Ã‰VALUATION COMPARATIVE ===")
soit score_rf = ml.evaluer_modele(rf_immobilier, donnees_std, categories_prix, "accuracy")
soit score_svm = ml.evaluer_modele(svm_immobilier, donnees_std, categories_prix, "accuracy")
soit score_knn = ml.evaluer_modele(knn_immobilier, donnees_std, categories_prix, "accuracy")

imprimer("Random Forest - PrÃ©cision:", arrondir(score_rf * 100, 1), "%")
imprimer("SVM - PrÃ©cision:", arrondir(score_svm * 100, 1), "%")
imprimer("KNN - PrÃ©cision:", arrondir(score_knn * 100, 1), "%")

# DÃ©terminer le meilleur modÃ¨le
soit meilleur_score = score_rf
soit meilleur_modele = rf_immobilier
soit nom_meilleur = "Random Forest"

si (score_svm > meilleur_score) {
    meilleur_score = score_svm
    meilleur_modele = svm_immobilier
    nom_meilleur = "SVM"
}

si (score_knn > meilleur_score) {
    meilleur_score = score_knn
    meilleur_modele = knn_immobilier
    nom_meilleur = "KNN"
}

imprimer("ğŸ† Meilleur modÃ¨le:", nom_meilleur, "avec", arrondir(meilleur_score * 100, 1), "% de prÃ©cision")
imprimer()

# Test sur nouveaux biens
imprimer("ğŸ”® === PRÃ‰DICTIONS SUR NOUVEAUX BIENS ===")
soit nouveaux_biens = [
    [60, 2, 10, 3.0],   # Devrait Ãªtre prix bas
    [90, 3, 4, 1.7],    # Devrait Ãªtre prix moyen
    [140, 5, 2, 0.7]    # Devrait Ãªtre prix Ã©levÃ©
]

soit nouveaux_biens_std = ml.standardiser_donnees(nouveaux_biens)
soit predictions = ml.predire(meilleur_modele, nouveaux_biens_std)

pour i dans [0, 1, 2] {
    soit bien = nouveaux_biens[i]
    soit pred = predictions[i]
    soit categorie = ""
    
    si (pred == 0) {
        categorie = "Prix BAS"
    } sinon si (pred == 1) {
        categorie = "Prix MOYEN"  
    } sinon {
        categorie = "Prix Ã‰LEVÃ‰"
    }
    
    imprimer("Bien", i + 1, ":", bien[0], "mÂ², ", bien[1], "ch, ", bien[2], "ans â†’", categorie)
}
imprimer()

# === PARTIE 2: CLUSTERING ===
imprimer("ğŸ¯ === CLUSTERING: SEGMENTATION AUTOMATIQUE ===")

# DonnÃ©es de comportement client: [age, revenu_kâ‚¬, nb_achats_mois]
soit donnees_clients = [
    [25, 30, 2], [28, 35, 3], [30, 40, 2],     # Jeunes actifs
    [45, 60, 5], [48, 65, 6], [50, 70, 4],     # Cadres moyens
    [35, 80, 8], [38, 85, 9], [40, 90, 7],     # Cadres supÃ©rieurs
    [60, 45, 1], [65, 40, 1], [70, 50, 2]      # Seniors
]

imprimer("ğŸ‘¥ Dataset clients:", longueur(donnees_clients), "profils")

# Clustering K-Means
soit kmeans_clients = ml.KMeans(3, 200)
soit donnees_clients_std = ml.standardiser_donnees(donnees_clients)

# Pour clustering, on passe des labels factices (K-means est non supervisÃ©)
soit labels_factices = []
pour i dans donnees_clients {
    ajouter(labels_factices, 0)
}

ml.entrainer(kmeans_clients, donnees_clients_std, labels_factices)
soit segments = ml.predire(kmeans_clients, donnees_clients_std)

imprimer("ğŸ¯ Segmentation automatique en 3 groupes:")
pour i dans [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11] {
    soit client = donnees_clients[i]
    soit segment = segments[i]
    imprimer("Client", i + 1, ": Ã¢ge", client[0], ", revenu", client[1], "kâ‚¬, achats", client[2], "â†’ Segment", segment)
}
imprimer()

# === PARTIE 3: RÃ‰GRESSION ===
imprimer("ğŸ“ˆ === RÃ‰GRESSION: PRÃ‰DICTION CONTINUE ===")

# DonnÃ©es de ventes: [budget_marketing_kâ‚¬, nb_vendeurs, satisfaction_client_%]
soit donnees_ventes_X = [
    [10, 2, 85], [15, 3, 90], [20, 4, 88], [25, 5, 92],
    [30, 6, 95], [35, 7, 89], [40, 8, 94], [45, 9, 96]
]

# Chiffre d'affaires en kâ‚¬
soit chiffre_affaires = [120, 180, 240, 300, 380, 420, 500, 580]

soit reg_model = ml.RandomForestRegressor(50, 8)
soit donnees_ventes_std = ml.standardiser_donnees(donnees_ventes_X)

ml.entrainer(reg_model, donnees_ventes_std, chiffre_affaires)

# Test prÃ©diction
soit nouveau_scenario = [[28, 5, 91]]
soit scenario_std = ml.standardiser_donnees(nouveau_scenario)
soit ca_predit = ml.predire(reg_model, scenario_std)

imprimer("PrÃ©diction CA avec budget 28kâ‚¬, 5 vendeurs, 91% satisfaction:")
imprimer("â†’ Chiffre d'affaires estimÃ©:", arrondir(ca_predit[0], 0), "kâ‚¬")
imprimer()

# === VALIDATION CROISÃ‰E ===
imprimer("âœ… === VALIDATION CROISÃ‰E ===")
soit validation = ml.validation_croisee(meilleur_modele, donnees_std, categories_prix, 3)
imprimer("Validation croisÃ©e (3 plis):")
imprimer("  Scores individuels:", validation["scores"])
imprimer("  PrÃ©cision moyenne:", arrondir(validation["moyenne"] * 100, 1), "%")
imprimer("  Ã‰cart-type:", arrondir(validation["ecart_type"] * 100, 1), "%")
imprimer()

imprimer("ğŸ‰ === DÃ‰MONSTRATION ML COMPLÃˆTE TERMINÃ‰E ===")
imprimer("âœ¨ F-IA Phase 3 - Ã‰cosystÃ¨me ML industriel opÃ©rationnel !")
imprimer("ğŸ“Š Classification, rÃ©gression, clustering et validation: âœ…")
